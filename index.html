<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>실시간 제어 다중섬광사진 시뮬레이터</title>
    <style>
        body { font-family: 'Pretendard', sans-serif; background: #f0f2f5; text-align: center; padding: 20px; margin: 0; }
        .container { width: 95%; max-width: 1200px; margin: auto; background: white; padding: 20px; border-radius: 15px; box-shadow: 0 8px 20px rgba(0,0,0,0.1); }
        .canvas-container { overflow-x: auto; background: #fff; border-bottom: 3px solid #333; margin-bottom: 15px; }
        canvas { display: block; }
        .controls { display: flex; justify-content: space-around; flex-wrap: wrap; padding: 15px; background: #f8f9fa; border-radius: 12px; margin: 20px 0; }
        .control-group { display: flex; flex-direction: column; width: 30%; min-width: 250px; margin: 10px; align-items: center; }
        .input-row { display: flex; align-items: center; gap: 10px; margin-top: 10px; width: 100%; justify-content: center; }
        .info-panel { background: #2c3e50; color: white; padding: 12px; border-radius: 8px; margin-bottom: 15px; font-size: 1.1em; }
        input[type=range] { cursor: pointer; width: 120px; }
        input[type=number] { width: 65px; padding: 5px; border: 1px solid #ccc; border-radius: 4px; text-align: center; }
        button { padding: 12px 40px; background: #e67e22; color: white; border: none; border-radius: 6px; cursor: pointer; font-size: 1.1em; font-weight: bold; }
        button:hover { background: #d35400; }
        label { font-weight: bold; color: #555; }
        .hint { color: #7f8c8d; font-size: 0.9em; margin-top: 5px; }
    </style>
</head>
<body>

<div class="container">
    <h2>⚽ 실시간 제어 다중섬광사진 시뮬레이션</h2>
    
    <div class="info-panel" id="dataDisplay">실시간 데이터 분석 중...</div>

    <div class="canvas-container">
        <canvas id="strobeCanvas" width="1600" height="220"></canvas>
    </div>

    <div class="controls">
        <div class="control-group">
            <label>실시간 속력 조절 (m/s)</label>
            <div class="input-row">
                <input type="range" id="speedRange" min="0" max="100" value="20">
                <input type="number" id="speedNum" min="0" max="100" value="20">
            </div>
            <div class="hint">운동 중 속력을 바꿔보세요!</div>
        </div>
        
        <div class="control-group">
            <label>섬광 빈도 조절 (Hz)</label>
            <div class="input-row">
                <input type="range" id="hzRange" min="1" max="30" step="1" value="2">
                <input type="number" id="hzNum" min="1" max="30" step="1" value="2">
            </div>
            <div class="hint">촬영 주기를 실시간으로 변경합니다.</div>
        </div>

        <div class="control-group" style="justify-content: center;">
            <button id="resetBtn">경로 초기화 (Clear)</button>
        </div>
    </div>
</div>

<script>
    const canvas = document.getElementById('strobeCanvas');
    const ctx = canvas.getContext('2d');
    
    const speedRange = document.getElementById('speedRange');
    const speedNum = document.getElementById('speedNum');
    const hzRange = document.getElementById('hzRange');
    const hzNum = document.getElementById('hzNum');
    const resetBtn = document.getElementById('resetBtn');
    const dataDisplay = document.getElementById('dataDisplay');

    let x = 0;
    let snapshots = [];
    let frameCount = 0;
    const FPS = 60;
    const meterToPixel = 8;

    // 입력 동기화 (기존 autoReset() 제거하여 실시간 반영)
    function syncInputs(el1, el2) {
        el1.addEventListener('input', () => { el2.value = el1.value; });
        el2.addEventListener('input', () => { 
            if(el2.value === "") return;
            let val = parseFloat(el2.value);
            if(val > el2.max) val = el2.max;
            el1.value = val;
        });
    }

    syncInputs(speedRange, speedNum);
    syncInputs(hzRange, hzNum);

    function draw() {
        const v = parseFloat(speedNum.value) || 0;
        const hz = parseFloat(hzNum.value) || 1;
        
        // 1. 물리 위치 계산
        const deltaX = (v * meterToPixel) / FPS;
        x += deltaX;

        // 2. 섬광 기록 로직 (프레임 기반 정밀 동기화)
        const strobeIntervalFrames = FPS / hz;
        if (frameCount >= strobeIntervalFrames) {
            snapshots.push(x);
            frameCount = 0; // 카운터 리셋하여 다음 주기를 정확히 계산
        }
        frameCount++;

        // 3. 렌더링
        ctx.clearRect(0, 0, canvas.width, canvas.height);

        // 눈금
        ctx.strokeStyle = "#ddd";
        ctx.fillStyle = "#888";
        for(let i=0; i<=200; i+=10) {
            let px = i * meterToPixel;
            ctx.beginPath(); ctx.moveTo(px, 150); ctx.lineTo(px, 170); ctx.stroke();
            if(i % 20 === 0) ctx.fillText(i + "m", px - 10, 190);
        }

        // 잔상들 (과거 기록)
        snapshots.forEach(pos => {
            ctx.beginPath();
            ctx.arc(pos, 80, 12, 0, Math.PI * 2);
            ctx.fillStyle = "rgba(52, 152, 219, 0.3)";
            ctx.fill();
        });

        // 현재 위치 공
        ctx.beginPath();
        ctx.arc(x, 80, 12, 0, Math.PI * 2);
        ctx.fillStyle = "#e67e22"; ctx.fill(); 
        ctx.strokeStyle = "#222"; ctx.lineWidth = 2; ctx.stroke();

        // 실시간 정보창
        dataDisplay.innerHTML = `현재 위치: ${(x/meterToPixel).toFixed(1)} m | 속력: ${v} m/s | 빈도: ${hz} Hz | <b>현재 잔상 간격: ${(v/hz).toFixed(2)} m</b>`;

        // 자동 반복 (끝까지 가면 위치만 리셋, 잔상은 새로 시작)
        if (x > canvas.width) {
            x = 0;
            snapshots = [];
            frameCount = 0;
        }
        
        requestAnimationFrame(draw);
    }

    // 수동 초기화 버튼
    resetBtn.addEventListener('click', () => {
        x = 0;
        snapshots = [];
        frameCount = 0;
    });

    draw();
</script>
</body>
</html>